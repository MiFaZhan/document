# 数据库

## 绿管平台数据库分析报告

基于对 `lvguan_platform.sql` 文件的详细分析，这是一个基于若依框架的车辆保险配件管理平台数据库。以下是完整的分析结果：

### 📊 数据库概览

- **数据库名称**: `lvguan_platform` (绿管平台)
- **数据库类型**: MySQL 8.0.39
- **字符集**: UTF8MB4
- **表总数**: 36张表
- **框架基础**: 若依(RuoYi)管理系统

### 🏗️ 表结构分类

#### 1. **系统管理表** (若依框架标准表)

- **用户权限管理**:
  - `sys_user` - 用户信息表
  - `sys_role` - 角色信息表  
  - `sys_menu` - 菜单权限表
  - `sys_dept` - 部门表
  - `sys_post` - 岗位信息表

- **系统配置**:
  - `sys_config` - 参数配置表
  - `sys_dict_type` - 字典类型表
  - `sys_dict_data` - 字典数据表
  - `sys_notice` - 通知公告表

- **日志审计**:
  - `sys_logininfor` - 系统访问记录
  - `sys_oper_log` - 操作日志记录

- **关联关系表**:
  - `sys_user_role` - 用户和角色关联表
  - `sys_user_post` - 用户与岗位关联表
  - `sys_role_menu` - 角色和菜单关联表
  - `sys_role_dept` - 角色和部门关联表

#### 2. **任务调度表** (Quartz框架)

- `qrtz_*` 系列表 (10张) - 定时任务相关
- `sys_job` - 定时任务调度表
- `sys_job_log` - 定时任务调度日志表

#### 3. **代码生成表**

- `gen_table` - 代码生成业务表
- `gen_table_column` - 代码生成业务表字段

#### 4. **核心业务表** (绿管平台特有)

##### 保险业务模块

```sql
tb_insurance_company - 保险公司信息表
├── id (主键)
├── insurance_company_name (保司名称)
├── interface_url (接口地址)
├── api_key/api_secret (API认证)
├── sync_time/sync_status (同步信息)
└── tenant_id (租户号)

tb_insurance_policy - 保险单表
├── id (主键)
├── insurance_policy_code (保单号)
├── insurance_company (保司名称)
├── license_plate_number (车牌号)
├── vin (车架号)
├── vehicle_owner_name (车主姓名)
├── insurance_start_time/end_time (保险期间)
└── tenant_id (租户号)
```

##### 配件管理模块

```sql
tb_vehicle_accessory - 配件表
├── id (主键)
├── name (配件名称)
├── oe_code (OE码)
├── vehicle_model (车型)
├── brand (配件品牌)
├── price (价格)
├── quality_inspection_time (质检时间)
└── tenant_id (租户号)

tb_vehicle_accessory_order - 配件订单表
├── id (主键)
├── insurance_policy_code (保单号)
├── accident_code (事故号)
├── damage_assessment_person (定损员)
├── damage_assessment_amount (定损金额)
├── accident_picture/vedio (事故资料)
└── tenant_id (租户号)

tb_vehicle_accessory_order_rela - 配件订单关系表
├── id (主键)
├── order_id (配件订单ID)
├── accessory_id (配件ID)
└── tenant_id (租户号)
```

##### 数据同步模块

```sql
tb_data_sync_record - 数据同步记录表
├── id (主键)
├── data_type (数据类型: 1-保单;2-配件;3-配件订单)
├── insurance_company_id (保司ID)
├── sync_time (同步时间)
├── sync_result (同步结果: 1-成功;2-失败)
└── tenant_id (租户号)
```

### 🔗 表关系分析

#### 业务关系链

1. **保险公司 → 保险单**: `tb_insurance_company` 通过公司名称关联 `tb_insurance_policy`
2. **保险单 → 配件订单**: `tb_insurance_policy.insurance_policy_code` = `tb_vehicle_accessory_order.insurance_policy_code`
3. **配件订单 ↔ 配件**: 通过 `tb_vehicle_accessory_order_rela` 中间表关联
4. **数据同步**: `tb_data_sync_record` 记录各业务表的同步状态

#### 多租户支持

- 所有业务表都包含 `tenant_id` 字段，支持多租户数据隔离

#### 审计字段

- 标准审计字段: `create_by`, `create_time`, `update_by`, `update_time`, `remark`

### 💡 业务特点分析

1. **车险理赔场景**: 专注于车辆保险理赔中的配件管理
2. **多保司对接**: 支持多家保险公司的数据同步
3. **配件质检**: 包含详细的配件质检信息(可视表面、漆厚测量等)
4. **事故管理**: 完整的事故信息记录(定损员、查勘员、事故图片等)
5. **SaaS架构**: 通过tenant_id实现多租户支持

### 🎯 技术架构特点

- **框架**: 基于若依(RuoYi)快速开发框架
- **权限**: RBAC权限模型 (用户-角色-菜单)
- **任务**: Quartz定时任务调度
- **多租户**: 基于tenant_id的数据隔离
- **代码生成**: 支持基于数据库表的代码自动生成

[1 tool called]

这个数据库设计体现了一个专业的车险配件管理平台，具有完整的权限管理、多租户支持和业务流程管理能力。整体架构清晰，表设计规范，适合作为车险理赔配件管理的核心数据存储系统。>)
# 实体类

ruoyi-platform 模块中的实体类（位于 com.ruoyi.lvguan.domain）

这是绿管平台的主要业务实体类：

- AmountByMonth
- BlockChainUpload
- Dept
- RegionData
- SaleSituation
- SysFileInfo
- TbAfterSalesServiceRecord
- TbInsuranceClaim
- TbInsuranceClaimPhoto
- TbInsuranceCompany
- TbInsurancePolicy
- TbInsurancePreorder
- TbInsurancePreorderAccessory
- TbInsuranceRepair
- TbInsuranceRepairPhoto
- TbProviderOrder
- TbVehicleAccessory
- TbVehicleAccessoryOrder
- TbVehicleAccessoryOrderRelationShip
- TbVehicleCaseInfo

## ruoyi-platform 模块实体类详解

ruoyi-platform 模块是整个项目的核心业务模块，包含了绿管平台的所有业务实体类。这些实体类主要处理保险、配件、订单等相关业务。

### 1. 保险单实体类 - TbInsurancePolicy

TbInsurancePolicy 是保险单的核心实体类，包含了保险单的所有信息：

基本信息：保单号、保司名称、循寻码、车牌号、车架号等

车辆信息：品牌类型、车主姓名、车主手机号等

保险信息：商业险保费、保险开始时间、保险结束时间等

状态信息：保单状态、保单详情文件、附件等

特色功能：支持同时存储到 MySQL 和 Elasticsearch，便于搜索和查询

该实体类还包含了一些转换方法，如将 InsurancePolicyDTO 转换为实体类，以及将实体类转换为 InsurancePolicyVO 等。

### 2. 报案管理实体类 - TbInsuranceClaim

TbInsuranceClaim 用于管理保险报案信息：

报案基本信息：保单号、车牌号、事故描述、事故地点等

处理信息：处理方式、出险时间、报案编号等

状态管理：通过 TbInsuranceClaimEnum 枚举管理状态

关联信息：与保单、引导员等的关联

### 3. 预订单实体类 - TbInsurancePreorder

TbInsurancePreorder 用于管理预订单信息：

订单信息：保单号、案件号、预订单号等

联系信息：联系方式、车主联系方式等

物流信息：运输方式、维修企业地址、支付方式等

状态管理：是否开票、当前状态等

### 4. 配件实体类 - TbVehicleAccessory

TbVehicleAccessory 是配件管理的核心实体类，非常详细：

配件基本信息：配件名称、OE码、适用车型、厂商单位等

质量信息：配件品质、质保期、质检时间等

订单信息：订单号、数量、计数单位、总价等

区块链信息：区块链哈希、各种质检的哈希值等

质检信息：前质检数据、抽检数据、供应商准入数据等

物流信息：物流单号、物流状态等

价格信息：对外单价、采购部单价、供应商单价等

详细质检项：包括外观查验、漆厚测量、金属板厚度、合车查验、通电点亮、灯具密封性、灯具外观等

### 5. 配件订单实体类 - TbVehicleAccessoryOrder

TbVehicleAccessoryOrder 用于管理配件订单：

订单基本信息：报案短信内容、引导员信息、时间信息等

车辆信息：保单号、车牌号、车架号、车型等

维修信息：送修维修厂、修理厂地址、维修单照片等

订单信息：销售单号、运输方式、付款方式、是否开票等

状态信息：订单状态、金额、下单时间等

### 6. 保险公司实体类 - TbInsuranceCompany

TbInsuranceCompany 用于管理保险公司信息：

基本信息：保司名称、接口地址、API密钥等

同步信息：同步时间、同步状态等

联系信息：联系方式等

### 特点总结

多数据源支持：部分实体类（如 TbInsurancePolicy 和 TbVehicleAccessory）支持同时存储到 MySQL 和 Elasticsearch，便于复杂查询和搜索。

丰富注解：使用了大量注解，如 MyBatis-Plus 的 @TableId、@TableName，Elasticsearch 的 @Document、@Field 等。

转换方法丰富：实体类中包含大量的静态转换方法，便于在 DTO、VO 和实体类之间进行转换。

业务逻辑紧密：实体类中直接包含了一些业务逻辑方法，如状态判断、数据转换等。

这些实体类构成了绿管平台的核心数据模型，支撑了整个平台的业务功能。
