在 Java 单元测试中，断言（Assertions）用于验证测试结果是否符合预期。以下是常见的断言分类和具体方法：

## 1. JUnit 5 核心断言

### 基本断言

```
import static org.junit.jupiter.api.Assertions.*;

// 相等性断言
assertEquals(expected, actual);
assertEquals(expected, actual, "错误信息");

// 布尔断言
assertTrue(condition);
assertFalse(condition);

// 空值断言
assertNull(object);
assertNotNull(object);

// 相同对象断言
assertSame(expected, actual); // 检查是否是同一个对象
assertNotSame(unexpected, actual);
```

### 异常断言

```
// 验证是否抛出特定异常
assertThrows(ExpectedException.class, () -> {
    codeThatShouldThrowException();
});

// 验证是否抛出特定异常并检查异常信息
Exception exception = assertThrows(IllegalArgumentException.class, () -> {
    throw new IllegalArgumentException("错误消息");
});
assertEquals("错误消息", exception.getMessage());
```

### 超时断言

```
// 验证代码执行时间
assertTimeout(Duration.ofSeconds(1), () -> {
    // 应在1秒内完成的代码
});

assertTimeoutPreemptively(Duration.ofMillis(100), () -> {
    // 如果超时立即终止
});
```

### 集合和数组断言

```
// 数组相等
assertArrayEquals(expectedArray, actualArray);

// 可迭代对象断言
Iterable<String> expected = Arrays.asList("a", "b", "c");
Iterable<String> actual = Arrays.asList("a", "b", "c");
assertIterableEquals(expected, actual);

// 行断言（忽略行分隔符差异）
assertLinesMatch(expectedLines, actualLines);
```

## 2. Mockito 验证断言

### 方法调用验证

```
import static org.mockito.Mockito.*;

// 验证方法调用次数
verify(mockObject).someMethod();
verify(mockObject, times(1)).someMethod();
verify(mockObject, atLeastOnce()).someMethod();
verify(mockObject, atLeast(2)).someMethod();
verify(mockObject, atMost(5)).someMethod();
verify(mockObject, never()).someMethod();

// 验证调用顺序
InOrder inOrder = inOrder(mock1, mock2);
inOrder.verify(mock1).firstMethod();
inOrder.verify(mock2).secondMethod();
```

### 参数匹配器

```
// 参数匹配验证
verify(mock).someMethod(anyString());
verify(mock).someMethod(eq("expectedValue"));
verify(mock).someMethod(startsWith("prefix"));
verify(mock).someMethod(anyInt(), argThat(arg -> arg > 0));

// 捕获参数进行详细验证
ArgumentCaptor<String> captor = ArgumentCaptor.forClass(String.class);
verify(mock).someMethod(captor.capture());
assertEquals("expected", captor.getValue());
```

## 3. AssertJ 流式断言（推荐）

```
import static org.assertj.core.api.Assertions.*;

// 对象断言
assertThat(actual).isEqualTo(expected);
assertThat(actual).isNotEqualTo(unexpected);
assertThat(actual).isSameAs(expectedObject);
assertThat(actual).isNotNull();

// 字符串断言
assertThat(string).contains("substring");
assertThat(string).startsWith("prefix");
assertThat(string).endsWith("suffix");
assertThat(string).hasSize(10);
assertThat(string).matches("regex.*");

// 集合断言
assertThat(collection).hasSize(3);
assertThat(collection).contains("element1", "element2");
assertThat(collection).containsExactly("elem1", "elem2", "elem3");
assertThat(collection).doesNotContain("unwanted");
assertThat(collection).isSorted();

// 数字断言
assertThat(number).isGreaterThan(5);
assertThat(number).isBetween(1, 10);
assertThat(number).isCloseTo(10, within(0.1));

// 异常断言
assertThatThrownBy(() -> { throw new Exception("error"); })
    .isInstanceOf(RuntimeException.class)
    .hasMessageContaining("error");

// 可选值断言
assertThat(optional).isPresent();
assertThat(optional).contains(expectedValue);
```

## 4. 自定义断言

### 自定义断言类

```
public class CustomAssertions {
    public static UserAssert assertThat(User actual) {
        return new UserAssert(actual);
    }
}

public class UserAssert extends AbstractAssert<UserAssert, User> {
    public UserAssert(User actual) {
        super(actual, UserAssert.class);
    }
    
    public UserAssert hasUsername(String username) {
        isNotNull();
        if (!actual.getUsername().equals(username)) {
            failWithMessage("Expected username to be <%s> but was <%s>", 
                username, actual.getUsername());
        }
        return this;
    }
}

// 使用自定义断言
assertThat(user).hasUsername("john").isActive();
```

## 5. 最佳实践

1. **使用有意义的错误信息**
    

```
assertEquals("用户年龄应该为25", 25, user.getAge());
```

1. **优先使用 AssertJ**（更易读的链式调用）
    
2. **合理使用参数匹配器**
    
3. **避免过度验证**（只验证重要的交互）
    

## 示例代码

```
@Test
void testUserService() {
    // 准备
    UserRepository mockRepo = mock(UserRepository.class);
    UserService service = new UserService(mockRepo);
    User expectedUser = new User("john", 25);
    
    when(mockRepo.findByUsername("john")).thenReturn(expectedUser);
    
    // 执行
    User result = service.getUser("john");
    
    // 验证
    assertThat(result)
        .isNotNull()
        .hasFieldOrPropertyWithValue("username", "john")
        .hasFieldOrPropertyWithValue("age", 25);
    
    verify(mockRepo, times(1)).findByUsername("john");
    verifyNoMoreInteractions(mockRepo);
}
```

选择哪种断言库取决于项目需求，但 AssertJ 通常提供最友好和强大的断言功能。